<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/css/stylesheet.css">
    
    
    <title>COVID-19 Dashboard</title>
    <meta name="description" content="A data dashboard to track the novel coronavirus COVID-19 cases and deaths in major countries."/>
    <meta name="og:title" property="og:title" content="COVID-19 Dashoard"/>
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@limitless_josh" />
    <meta property="og:description" content="A data dashboard to track the novel coronavirus COVID-19 cases and deaths in major countries." />
    <meta property="og:image" content="ogimage.png" />
    <meta property="og:url" content="http://coviddash.digital" />
    <meta name="twitter:image" content="ogimage.png" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-colorschemes"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-162603226-1"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-162603226-1');
    </script>
    <head>
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
</head>
    <script>
        $(document).ready(function(){
            setInterval(updateCases,10000);
        });
        $(document).ready(function(){
            setInterval(updateDeaths,10000);
        });
    </script>
</head>


<body>
    <header>
        {{> header}}
    </header>
    <script>
        function updateCases() {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    document.getElementById("cases").innerHTML = this.responseText;
                }
            };
            xhttp.open("GET", "/counters/cases", true);
            xhttp.send();
        }
    </script>
    <script>
        function updateDeaths() {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    document.getElementById("deaths").innerHTML = this.responseText;
                }
            };
            xhttp.open("GET", "/counters/deaths", true);
            xhttp.send();
        }
    </script>
    <div class="container" style="padding-top: 20px;">
        <div class="row">
            <div class="col-md leftCard">
                <div class="worldCard">
                <p class="cardtitle">Confirmed worldwide cases</p>
                <p class="data" id="cases">{{{counterdata.cases}}}</p>
                </div>
            </div>
            <div class="col-md rightCard">
                <div class="worldCard">
                <p class="cardtitle">Confirmed worldwide deaths</p>
                <p class="data" id="deaths">{{{counterdata.deaths}}}</p>
                </div>
            </div>
        </div>
        
        <svg height="20" width="20" class="update" style="float: left;">
            <circle cx="10" cy="10" r="5" fill="red" />
        </svg>
        <p class="update" style="float: left; font-size: 15px; color:darkgrey;">Checking for updates</p>
        <p style="text-align: right;">Source: <a href="https://www.worldometers.info/coronavirus/">Worldometers</a>, <a href="https://bnonews.com/index.php/2020/04/the-latest-coronavirus-cases/">BNO News</a></p>
        <br>
        <div class="row">
            <p style="font-size: 12px;">Tip: Click a country's name on the legend below to remove the country from the graph.</p>
            <canvas id="deathChart" height="600"></canvas>
        </div>
        
    <script>
        var ctx = document.getElementById('deathChart').getContext('2d');
        var deathChart = new Chart(ctx, {
            type: 'line',
            data: {
                datasets: [/*{
                    label: 'China',
                    backgroundColor: 'rgba(255,0,0,0.4)',
                    borderColor: 'rgba(255,0,0,0.4)',
                    data: {{{json CHNdata }}},
                    fill: false
                },*/ {
                    label: 'United Kingdom',
                    data: {{{json UKdata}}},
                    fill: false
                }, {
                    label: 'Italy',
                    data: {{{json ITAdata}}},
                    fill: false
                }, {
                    label: 'Spain',
                    data: {{{json ESPdata}}},
                    fill: false
                }, {
                    label: 'United States',
                    data: {{{json USAdata}}},
                    fill: false
                }, {
                    label: 'South Korea',
                    data: {{{json KORdata}}},
                    fill: false
                }, {
                    label: 'Germany',
                    data: {{{json DEUdata}}},
                    fill: false
                }, /*{
                    label: 'Japan',
                    data: {{{json JPNdata}}},
                    fill: false
                }*/],
            labels: {{{json dates}}}
            },
            options: {
                plugins: {
                    colorschemes: {
                        fillAlpha: 0.8,
                        scheme: 'brewer.SetOne9',                      
                    },
                },
                tooltips: {
                    enabled: true,
                    callbacks: {
                        beforeTitle: function(toolTipItem, data) {
                            return 'Total confirmed deaths: '
                        },
                        beforeBody: function(toolTipItem, data) {
                            return 'Weekly confirmed deaths: '
                        },
                        footer: function(toolTipItem, data) {
                            var dates = {{{json dates}}}
                            var dateObj = {
                                'United Kingdom': 'GBR',
                                'Italy': 'ITA',
                                'Spain': 'ESP',
                                'United States': 'USA',
                                'South Korea': 'KOR',
                                'Germany': 'DEU'
                            }
                            var countryCode = dateObj[data.datasets[toolTipItem[0].datasetIndex].label]
                            return dates[countryCode][toolTipItem[0].index]
                        }
                    }
            },  
            responsive: false,
            maintainAspectRatio: false,
            scales: {
                yAxes: [{
                    scaleLabel: {
                        display: true,
                        labelString: 'Weekly confirmed deaths'
                    },
                    type: 'logarithmic',
                    ticks: {
                        min: 10, //minimum tick
                        max: 10000, //maximum tick
                        callback: function (value, index, values) {
                            return Number(value.toString());//pass tick values as a string into Number function
                        }
                    },
                    afterBuildTicks: function (chartObj) { //Build ticks labelling as per your need
                        chartObj.ticks = [];
                        chartObj.ticks.push(10);
                        chartObj.ticks.push(100);
                        chartObj.ticks.push(1000);
                        chartObj.ticks.push(10000);
                        chartObj.ticks.push(100000);
                    }
                }],
                xAxes: [{
                    scaleLabel: {
                        display: true,
                        labelString: 'Total confirmed deaths'
                    },
                    type: 'logarithmic',
                    ticks: {
                        min: 100, //minimum tick
                        max: 50000, //maximum tick
                        callback: function (value, index, values) {
                            return Number(value.toString());//pass tick values as a string into Number function
                        }
                    },
                    afterBuildTicks: function (chartObj) { //Build ticks labelling as per your need
                        chartObj.ticks = [];
                        chartObj.ticks.push(100);
                        chartObj.ticks.push(1000);
                        chartObj.ticks.push(10000);
                        chartObj.ticks.push(50000);
                    }
                }]
            }
        }
    });
    </script>
    <p style="float: left;"> Data: <a href="https://www.ecdc.europa.eu/en/publications-data/download-todays-data-geographic-distribution-covid-19-cases-worldwide">European Centre for Disease Control</a></p>
    <p class="graphupdate" style="text-align:right;">Last checked for update: {{{lastUpdate}}}</p>
    <br>
    <section class="faq">
        <section class="qa-block">
            <p class="question">What is this?</p>
            <p class="answer">This is a dashboard of information relating to the 2019/2020 COVID-19 pandemic. The counters at the top show the latest worldwide cases and deaths, and the graph shows the confirmed deaths of COVID-19 in some major countries against the total confirmed deaths for each country. The diagonal line that most countries follow is the period of exponential growth. Italy and Spain appear to be approaching their peaks. Note that this means they are having the same amount of weekly deaths. As the line for China shows, as a country starts reporting less weekly cases, it will drop dramatically. This is when a country has reached its peak daily deaths.</p>
        </section>
        <!---<section class="qa-block">
            <p class="question">China's data is rubbish!!! Why are you showing it?</p>
            <p class="answer">Because there is simply no way of knowing. It's quite hard to hide an epidemic and there is no evidence suggesting their death figures are completely wrong. Their data may or may not be correct, but I've plotted them anyway. I may remove it in the future. Other countries will be added an removed as the situation changes. </p>
        </section>--->
        <section class="qa-block">
            <p class="question">Why's this different from the other graphs I've seen?</p>
            <p class="answer">It probably shows the same trend - countries roughly following the same trajectory. Most graphs I've seen plot a measure of cases or deaths against a time (e.g. days since nth death). The approach on this web page is in my opinion better as it ignores time.</p>
        </section>
        <section class="qa-block">
            <p class="question">How often is this updated?</p>
            <p class="answer">The counters check for updates every two minutes. You don't need to refresh the page, they will update automatically if new data is available. The graph uses ECDC data which is updated every morning (UTC), which could be up to 24 hours after a country has released it. The graph may therefore take up to 24 hours to update. The counters at the top of the page for cases and deaths update very frequently and use different sources.</p>
        </section>
        <section class="qa-block">
            <p class="question">Can I use your data/How did you make this/is there a GitHub repo?</p>
            <p class="answer">All code, including for the web app, is available on GitHub <a href="https://github.com/josh-cb/COVID-19_Dashboard">here</a>.</p>
        </section>
    </section>
    </div>
</body>
</html>